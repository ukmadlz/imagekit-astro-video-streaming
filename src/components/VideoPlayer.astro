---
// src/components/VideoPlayer.astro
interface Props {
  src: string;
  poster?: string;
  width?: number;
  height?: number;
}

const { src, poster, width = 640, height = 360 } = Astro.props;
const playerId = `video-${Math.random().toString(36).substr(2, 9)}`;
---

<div class="video-player-wrapper">
  <video
    id={playerId}
    class="video-js vjs-default-skin"
    controls
    preload="auto"
    width={width}
    height={height}
    poster={poster}
    data-src={src}
  >
    <source src={src} type="video/mp4" />
  </video>
</div>

<script>
  import videojs from 'video.js';
  import 'video.js/dist/video-js.css';

  // Initialize all video players on the page
  document.querySelectorAll('.video-js').forEach((element) => {
    if (element instanceof HTMLVideoElement && !element.hasAttribute('data-vjs-player')) {
      const player = videojs(element, {
        fluid: true,
        playbackRates: [0.5, 1, 1.5, 2],
      });

      // Cleanup on navigation (for Astro view transitions)
      document.addEventListener('astro:before-swap', () => {
        player.dispose();
      });
    }
  });
</script>

<style>
  .video-player-wrapper {
    max-width: 100%;
  }
</style>
