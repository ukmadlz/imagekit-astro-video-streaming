---
// src/components/LazyVideo.astro
interface Props {
  src: string;
  poster?: string;
  width?: number;
  height?: number;
}

const { src, poster, width = 640, height = 360 } = Astro.props;

// Generate a low-quality poster if none provided
const posterUrl = poster || `${src}/ik-thumbnail.jpg?tr=w-${width},h-${height},q-50`;
---

<div class="lazy-video" data-src={src} style={`aspect-ratio: ${width}/${height};`}>
  <img
    src={posterUrl}
    alt="Video thumbnail"
    loading="lazy"
    width={width}
    height={height}
  />
  <button class="play-button" aria-label="Play video">
    <svg viewBox="0 0 24 24" fill="currentColor" width="48" height="48">
      <path d="M8 5v14l11-7z"/>
    </svg>
  </button>
</div>

<script>
  document.querySelectorAll('.lazy-video').forEach((container) => {
    const button = container.querySelector('.play-button');
    const img = container.querySelector('img');

    button?.addEventListener('click', () => {
      const src = container.getAttribute('data-src');
      if (!src) return;

      const video = document.createElement('video');
      video.src = src;
      video.controls = true;
      video.autoplay = true;
      video.style.width = '100%';
      video.style.height = '100%';

      container.innerHTML = '';
      container.appendChild(video);
    });
  });
</script>

<style>
  .lazy-video {
    position: relative;
    background: #000;
    cursor: pointer;
  }

  .lazy-video img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .play-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.7);
    border: none;
    border-radius: 50%;
    padding: 16px;
    color: white;
    cursor: pointer;
    transition: background 0.2s;
  }

  .play-button:hover {
    background: rgba(0, 0, 0, 0.9);
  }
</style>
